---
import ArticleLayout from '../layouts/ArticleLayout.astro';
import FigureIsland from '../components/FigureIsland.astro';
import D3Chart from '../components/D3Chart.svelte';
import EmbeddingsFigure from '../components/figures/EmbeddingsFigure.svelte';
import TrainingCurvesFigure from '../components/figures/TrainingCurvesFigure.svelte';
import RocCurvesFigure from '../components/figures/RocCurvesFigure.svelte';
import { FIGURES } from '../config/figures';
import { getCollection } from 'astro:content';

// Load static data from content collections
const kdTransferEntries = await getCollection('kdTransfer');
const kdTransferData = kdTransferEntries
  .filter(e => e.data.metric_name === 'f1')
  .map(e => e.data);

const modelSizesEntries = await getCollection('modelSizes');
const modelSizesData = modelSizesEntries.map(e => e.data);
---

<ArticleLayout title="Figure Showcase â€” KD-GAT">
  <h1>Figure Showcase</h1>
  <p>
    All {FIGURES.length} paper figures registered in the figure registry.
    Static figures render from content collections; interactive figures fetch per-run data on demand.
  </p>

  <!-- Registry table -->
  <div class="l-wide">
    <table>
      <thead>
        <tr>
          <th>#</th>
          <th>ID</th>
          <th>Chart Type</th>
          <th>Layout</th>
          <th>Data Source</th>
          <th>Section</th>
        </tr>
      </thead>
      <tbody>
        {FIGURES.map((fig) => (
          <tr>
            <td>{fig.number}</td>
            <td><code>{fig.id}</code></td>
            <td>{fig.chartType}</td>
            <td><code>.l-{fig.layout}</code></td>
            <td>
              {fig.staticData
                ? <span class="badge badge-green">collection: {fig.staticData}</span>
                : fig.dataSource
                  ? <span class="badge badge-blue">fetch: {fig.dataSource}</span>
                  : <span class="badge badge-gray">interactive</span>
              }
            </td>
            <td>{fig.section}</td>
          </tr>
        ))}
      </tbody>
    </table>
  </div>

  <hr />

  <!-- Static figures (from content collections) -->
  <h2>Static Figures</h2>

  <FigureIsland figureId="fig-kd-transfer" data={kdTransferData} height={420} />

  <FigureIsland figureId="fig-model-sizes" data={modelSizesData} height={350} />

  <!-- Runtime-fetched figure (graph structure) -->
  <div class="l-wide">
    <figure>
      <D3Chart
        client:only="svelte"
        chartType="force"
        dataSource="graph_samples.json"
        height={450}
      />
      <figcaption>
        <strong>Figure 1.</strong> CAN message graph structure with node degree sizing.
        (Fetched at runtime from <code>/data/graph_samples.json</code>.)
      </figcaption>
    </figure>
  </div>

  <hr />

  <!-- Interactive figures -->
  <h2>Interactive Figures</h2>
  <p>
    These figures fetch per-run data based on dropdown selections.
    Change the controls to explore different runs, models, and configurations.
  </p>

  <div class="l-wide">
    <figure>
      <EmbeddingsFigure client:only="svelte" />
      <figcaption>
        <strong>Figure 8.</strong> Latent space projections colored by traffic label.
      </figcaption>
    </figure>
  </div>

  <div class="l-wide">
    <figure>
      <TrainingCurvesFigure client:only="svelte" />
      <figcaption>
        <strong>Figure 3.</strong> Training loss curves.
      </figcaption>
    </figure>
  </div>

  <div class="l-body">
    <figure>
      <RocCurvesFigure client:only="svelte" />
      <figcaption>
        <strong>Figure 5.</strong> ROC curves comparing VGAE, GAT, and DQN-Fusion.
      </figcaption>
    </figure>
  </div>
</ArticleLayout>

<style is:global>
  table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.875rem;
    margin: 1rem 0;
  }

  th, td {
    padding: 0.5rem 0.75rem;
    text-align: left;
    border-bottom: 1px solid #e2e8f0;
  }

  th {
    font-weight: 600;
    color: #374151;
    background: #f8f9fa;
  }

  hr {
    border: none;
    border-top: 1px solid #e2e8f0;
    margin: 2rem 0;
  }

  .badge {
    display: inline-block;
    padding: 0.15em 0.5em;
    border-radius: 4px;
    font-size: 0.8em;
    font-weight: 500;
  }

  .badge-green {
    background: #dcfce7;
    color: #166534;
  }

  .badge-blue {
    background: #dbeafe;
    color: #1e40af;
  }

  .badge-gray {
    background: #f1f5f9;
    color: #475569;
  }
</style>
