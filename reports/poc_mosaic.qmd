---
title: "Mosaic + DuckDB-WASM POC"
format:
  html:
    toc: true
    code-fold: true
---

## Setup

Initialize Mosaic vgplot with DuckDB-WASM running entirely in-browser.

```{ojs}
//| label: mosaic-setup
import { vg, loadParquetTable } from "./_ojs/mosaic-setup.js"
```

## Training Curves from Local Parquet

Load a training curve Parquet file via `FileAttachment` into DuckDB-WASM, then render an interactive line chart with Mosaic vgplot.

```{ojs}
//| label: load-training-curves
trainingLoaded = {
  const url = await FileAttachment("data/hcrl_sa_gat_large_curriculum.parquet").url();
  await vg.coordinator().exec(
    vg.loadParquet("training_curves", url)
  );
  return true;
}
```

```{ojs}
//| label: fig-training-loss
//| fig-cap: "GAT training curves (hcrl_sa, large model) â€” loss and accuracy per epoch, loaded from local Parquet via DuckDB-WASM."
trainingLoaded;
vg.plot(
  vg.lineY(
    vg.from("training_curves"),
    { x: "epoch", y: "value", stroke: "metric" }
  ),
  vg.width(680),
  vg.height(400),
  vg.colorLegend(true),
  vg.xLabel("Epoch"),
  vg.yLabel("Value")
)
```

## Metrics Overview

Load the full metrics Parquet and show F1 scores across datasets.

```{ojs}
//| label: load-metrics
metricsLoaded = {
  const url = await FileAttachment("data/metrics.parquet").url();
  await vg.coordinator().exec(
    vg.loadParquet("metrics", url)
  );
  return true;
}
```

```{ojs}
//| label: fig-metrics-dot
//| fig-cap: "Per-run best F1 scores by dataset and model type."
metricsLoaded;
vg.plot(
  vg.dot(
    vg.from("metrics", { filterBy: vg.sql`metric_name = 'f1'` }),
    {
      x: "dataset",
      y: "best_value",
      fill: "model_type",
      r: 6
    }
  ),
  vg.width(680),
  vg.height(400),
  vg.colorLegend(true),
  vg.xLabel("Dataset"),
  vg.yLabel("F1 Score")
)
```
